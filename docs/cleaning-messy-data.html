<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Cleaning Messy Data | R Basics</title>
  <meta name="description" content="4 Cleaning Messy Data | R Basics" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Cleaning Messy Data | R Basics" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://ucdavisdatalab.github.io/workshop_r_basics/" />
  
  
  <meta name="github-repo" content="ucdavisdatalab/workshop_r-basics" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Cleaning Messy Data | R Basics" />
  
  
  

<meta name="author" content="Nick Ulle" />


<meta name="date" content="2022-09-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="exploring-your-data.html"/>
<link rel="next" href="where-to-learn-more.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://datalab.ucdavis.edu/">
  <img src="https://datalab.ucdavis.edu/wp-content/uploads/2019/07/datalab-logo-full-color-rgb-1.png" style="height: 100%; width: 100%; object-fit: contain" />
</a></li>
<li><a href="./" style="font-size: 18px">R Basics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="1" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>1</b> Getting Started</a>
<ul>
<li class="chapter" data-level="1.1" data-path="getting-started.html"><a href="getting-started.html#prerequisites"><i class="fa fa-check"></i><b>1.1</b> Prerequisites</a></li>
<li class="chapter" data-level="1.2" data-path="getting-started.html"><a href="getting-started.html#the-r-interface"><i class="fa fa-check"></i><b>1.2</b> The R Interface</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="getting-started.html"><a href="getting-started.html#variables"><i class="fa fa-check"></i><b>1.2.1</b> Variables</a></li>
<li class="chapter" data-level="1.2.2" data-path="getting-started.html"><a href="getting-started.html#calling-functions"><i class="fa fa-check"></i><b>1.2.2</b> Calling Functions</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="getting-started.html"><a href="getting-started.html#getting-help"><i class="fa fa-check"></i><b>1.3</b> Getting Help</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="getting-started.html"><a href="getting-started.html#when-something-goes-wrong"><i class="fa fa-check"></i><b>1.3.1</b> When Something Goes Wrong</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="getting-started.html"><a href="getting-started.html#file-systems"><i class="fa fa-check"></i><b>1.4</b> File Systems</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="getting-started.html"><a href="getting-started.html#absolute-relative-paths"><i class="fa fa-check"></i><b>1.4.1</b> Absolute &amp; Relative Paths</a></li>
<li class="chapter" data-level="1.4.2" data-path="getting-started.html"><a href="getting-started.html#r-scripts"><i class="fa fa-check"></i><b>1.4.2</b> R Scripts</a></li>
<li class="chapter" data-level="1.4.3" data-path="getting-started.html"><a href="getting-started.html#the-working-directory"><i class="fa fa-check"></i><b>1.4.3</b> The Working Directory</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="getting-started.html"><a href="getting-started.html#reading-files"><i class="fa fa-check"></i><b>1.5</b> Reading Files</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="getting-started.html"><a href="getting-started.html#hello-data"><i class="fa fa-check"></i><b>1.5.1</b> Hello, Data!</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="getting-started.html"><a href="getting-started.html#data-frames"><i class="fa fa-check"></i><b>1.6</b> Data Frames</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="getting-started.html"><a href="getting-started.html#summarizing-data"><i class="fa fa-check"></i><b>1.6.1</b> Summarizing Data</a></li>
<li class="chapter" data-level="1.6.2" data-path="getting-started.html"><a href="getting-started.html#selecting-columns"><i class="fa fa-check"></i><b>1.6.2</b> Selecting Columns</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="getting-started.html"><a href="getting-started.html#vectors"><i class="fa fa-check"></i><b>1.7</b> Vectors</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="getting-started.html"><a href="getting-started.html#creating-vectors"><i class="fa fa-check"></i><b>1.7.1</b> Creating Vectors</a></li>
<li class="chapter" data-level="1.7.2" data-path="getting-started.html"><a href="getting-started.html#indexing-vectors"><i class="fa fa-check"></i><b>1.7.2</b> Indexing Vectors</a></li>
<li class="chapter" data-level="1.7.3" data-path="getting-started.html"><a href="getting-started.html#vectorization"><i class="fa fa-check"></i><b>1.7.3</b> Vectorization</a></li>
<li class="chapter" data-level="1.7.4" data-path="getting-started.html"><a href="getting-started.html#recycling"><i class="fa fa-check"></i><b>1.7.4</b> Recycling</a></li>
<li class="chapter" data-level="1.7.5" data-path="getting-started.html"><a href="getting-started.html#making-comparisons"><i class="fa fa-check"></i><b>1.7.5</b> Making Comparisons</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-structures.html"><a href="data-structures.html"><i class="fa fa-check"></i><b>2</b> Data Structures</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-structures.html"><a href="data-structures.html#data-types-classes"><i class="fa fa-check"></i><b>2.1</b> Data Types &amp; Classes</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="data-structures.html"><a href="data-structures.html#lists"><i class="fa fa-check"></i><b>2.1.1</b> Lists</a></li>
<li class="chapter" data-level="2.1.2" data-path="data-structures.html"><a href="data-structures.html#implicit-coercion"><i class="fa fa-check"></i><b>2.1.2</b> Implicit Coercion</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="data-structures.html"><a href="data-structures.html#special-values"><i class="fa fa-check"></i><b>2.2</b> Special Values</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="data-structures.html"><a href="data-structures.html#missing-values"><i class="fa fa-check"></i><b>2.2.1</b> Missing Values</a></li>
<li class="chapter" data-level="2.2.2" data-path="data-structures.html"><a href="data-structures.html#infinity"><i class="fa fa-check"></i><b>2.2.2</b> Infinity</a></li>
<li class="chapter" data-level="2.2.3" data-path="data-structures.html"><a href="data-structures.html#not-a-number"><i class="fa fa-check"></i><b>2.2.3</b> Not a Number</a></li>
<li class="chapter" data-level="2.2.4" data-path="data-structures.html"><a href="data-structures.html#null"><i class="fa fa-check"></i><b>2.2.4</b> Null</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="data-structures.html"><a href="data-structures.html#matrices-arrays"><i class="fa fa-check"></i><b>2.3</b> Matrices &amp; Arrays</a></li>
<li class="chapter" data-level="2.4" data-path="data-structures.html"><a href="data-structures.html#factors"><i class="fa fa-check"></i><b>2.4</b> Factors</a></li>
<li class="chapter" data-level="2.5" data-path="data-structures.html"><a href="data-structures.html#indexing"><i class="fa fa-check"></i><b>2.5</b> Indexing</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="data-structures.html"><a href="data-structures.html#all-elements"><i class="fa fa-check"></i><b>2.5.1</b> All Elements</a></li>
<li class="chapter" data-level="2.5.2" data-path="data-structures.html"><a href="data-structures.html#by-position"><i class="fa fa-check"></i><b>2.5.2</b> By Position</a></li>
<li class="chapter" data-level="2.5.3" data-path="data-structures.html"><a href="data-structures.html#by-name"><i class="fa fa-check"></i><b>2.5.3</b> By Name</a></li>
<li class="chapter" data-level="2.5.4" data-path="data-structures.html"><a href="data-structures.html#by-condition"><i class="fa fa-check"></i><b>2.5.4</b> By Condition</a></li>
<li class="chapter" data-level="2.5.5" data-path="data-structures.html"><a href="data-structures.html#logic"><i class="fa fa-check"></i><b>2.5.5</b> Logic</a></li>
<li class="chapter" data-level="2.5.6" data-path="data-structures.html"><a href="data-structures.html#indexing-lists"><i class="fa fa-check"></i><b>2.5.6</b> Indexing Lists</a></li>
<li class="chapter" data-level="2.5.7" data-path="data-structures.html"><a href="data-structures.html#indexing-data-frames"><i class="fa fa-check"></i><b>2.5.7</b> Indexing Data Frames</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="exploring-your-data.html"><a href="exploring-your-data.html"><i class="fa fa-check"></i><b>3</b> Exploring Your Data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="exploring-your-data.html"><a href="exploring-your-data.html#apply-functions"><i class="fa fa-check"></i><b>3.1</b> Apply Functions</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="exploring-your-data.html"><a href="exploring-your-data.html#the-sapply-function"><i class="fa fa-check"></i><b>3.1.1</b> The <code>sapply</code> Function</a></li>
<li class="chapter" data-level="3.1.2" data-path="exploring-your-data.html"><a href="exploring-your-data.html#the-split-apply-pattern"><i class="fa fa-check"></i><b>3.1.2</b> The Split-Apply Pattern</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="exploring-your-data.html"><a href="exploring-your-data.html#conditional-expressions"><i class="fa fa-check"></i><b>3.2</b> Conditional Expressions</a></li>
<li class="chapter" data-level="3.3" data-path="exploring-your-data.html"><a href="exploring-your-data.html#functions"><i class="fa fa-check"></i><b>3.3</b> Functions</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="exploring-your-data.html"><a href="exploring-your-data.html#returning-values"><i class="fa fa-check"></i><b>3.3.1</b> Returning Values</a></li>
<li class="chapter" data-level="3.3.2" data-path="exploring-your-data.html"><a href="exploring-your-data.html#planning-your-functions"><i class="fa fa-check"></i><b>3.3.2</b> Planning Your Functions</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="exploring-your-data.html"><a href="exploring-your-data.html#variable-scope-lookup"><i class="fa fa-check"></i><b>3.4</b> Variable Scope &amp; Lookup</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="exploring-your-data.html"><a href="exploring-your-data.html#local-variables"><i class="fa fa-check"></i><b>3.4.1</b> Local Variables</a></li>
<li class="chapter" data-level="3.4.2" data-path="exploring-your-data.html"><a href="exploring-your-data.html#lexical-scoping"><i class="fa fa-check"></i><b>3.4.2</b> Lexical Scoping</a></li>
<li class="chapter" data-level="3.4.3" data-path="exploring-your-data.html"><a href="exploring-your-data.html#dynamic-lookup"><i class="fa fa-check"></i><b>3.4.3</b> Dynamic Lookup</a></li>
<li class="chapter" data-level="3.4.4" data-path="exploring-your-data.html"><a href="exploring-your-data.html#summary"><i class="fa fa-check"></i><b>3.4.4</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="exploring-your-data.html"><a href="exploring-your-data.html#packages"><i class="fa fa-check"></i><b>3.5</b> Packages</a></li>
<li class="chapter" data-level="3.6" data-path="exploring-your-data.html"><a href="exploring-your-data.html#data-visualization"><i class="fa fa-check"></i><b>3.6</b> Data Visualization</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="exploring-your-data.html"><a href="exploring-your-data.html#layer-1-data"><i class="fa fa-check"></i><b>3.6.1</b> Layer 1: Data</a></li>
<li class="chapter" data-level="3.6.2" data-path="exploring-your-data.html"><a href="exploring-your-data.html#layer-2-geometry"><i class="fa fa-check"></i><b>3.6.2</b> Layer 2: Geometry</a></li>
<li class="chapter" data-level="3.6.3" data-path="exploring-your-data.html"><a href="exploring-your-data.html#layer-3-aesthetics"><i class="fa fa-check"></i><b>3.6.3</b> Layer 3: Aesthetics</a></li>
<li class="chapter" data-level="3.6.4" data-path="exploring-your-data.html"><a href="exploring-your-data.html#layer-4-scales"><i class="fa fa-check"></i><b>3.6.4</b> Layer 4: Scales</a></li>
<li class="chapter" data-level="3.6.5" data-path="exploring-your-data.html"><a href="exploring-your-data.html#saving-plots"><i class="fa fa-check"></i><b>3.6.5</b> Saving Plots</a></li>
<li class="chapter" data-level="3.6.6" data-path="exploring-your-data.html"><a href="exploring-your-data.html#example-bar-plot"><i class="fa fa-check"></i><b>3.6.6</b> Example: Bar Plot</a></li>
<li class="chapter" data-level="3.6.7" data-path="exploring-your-data.html"><a href="exploring-your-data.html#visualization-design"><i class="fa fa-check"></i><b>3.6.7</b> Visualization Design</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="cleaning-messy-data.html"><a href="cleaning-messy-data.html"><i class="fa fa-check"></i><b>4</b> Cleaning Messy Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="cleaning-messy-data.html"><a href="cleaning-messy-data.html#loops"><i class="fa fa-check"></i><b>4.1</b> Loops</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="cleaning-messy-data.html"><a href="cleaning-messy-data.html#for-loops"><i class="fa fa-check"></i><b>4.1.1</b> For-loops</a></li>
<li class="chapter" data-level="4.1.2" data-path="cleaning-messy-data.html"><a href="cleaning-messy-data.html#while-loops"><i class="fa fa-check"></i><b>4.1.2</b> While-loops</a></li>
<li class="chapter" data-level="4.1.3" data-path="cleaning-messy-data.html"><a href="cleaning-messy-data.html#saving-multiple-results"><i class="fa fa-check"></i><b>4.1.3</b> Saving Multiple Results</a></li>
<li class="chapter" data-level="4.1.4" data-path="cleaning-messy-data.html"><a href="cleaning-messy-data.html#break-next"><i class="fa fa-check"></i><b>4.1.4</b> Break &amp; Next</a></li>
<li class="chapter" data-level="4.1.5" data-path="cleaning-messy-data.html"><a href="cleaning-messy-data.html#example-fibonacci"><i class="fa fa-check"></i><b>4.1.5</b> Example: Fibonacci</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="cleaning-messy-data.html"><a href="cleaning-messy-data.html#planning-for-iteration"><i class="fa fa-check"></i><b>4.2</b> Planning for Iteration</a></li>
<li class="chapter" data-level="4.3" data-path="cleaning-messy-data.html"><a href="cleaning-messy-data.html#string-processing"><i class="fa fa-check"></i><b>4.3</b> String Processing</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="cleaning-messy-data.html"><a href="cleaning-messy-data.html#splitting-strings"><i class="fa fa-check"></i><b>4.3.1</b> Splitting Strings</a></li>
<li class="chapter" data-level="4.3.2" data-path="cleaning-messy-data.html"><a href="cleaning-messy-data.html#replacing-parts-of-strings"><i class="fa fa-check"></i><b>4.3.2</b> Replacing Parts of Strings</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="cleaning-messy-data.html"><a href="cleaning-messy-data.html#date-processing"><i class="fa fa-check"></i><b>4.4</b> Date Processing</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="where-to-learn-more.html"><a href="where-to-learn-more.html"><i class="fa fa-check"></i>Where to Learn More</a></li>
<li class="chapter" data-level="" data-path="acknowledgements.html"><a href="acknowledgements.html"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R Basics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="cleaning-messy-data" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Cleaning Messy Data</h1>
<p>By now, we’ve learned all of the basic skills necessary to explore a data set
in R. This final chapter is a collection of different topics relevant to
cleaning data sets before and during analysis. Some of them, like loops, also
have other applications.</p>
<div id="loops" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Loops</h2>
<p>One major benefit of using a programming language like R is that repetitive
tasks can be automated. We’ve already seen two ways to do this:</p>
<ol style="list-style-type: decimal">
<li><p>Vectorization, introduced in Section <a href="getting-started.html#vectorization">1.7.3</a></p></li>
<li><p>Apply functions, introduced in Section <a href="exploring-your-data.html#apply-functions">3.1</a></p></li>
</ol>
<p>Both of these are <em>iteration strategies</em>. They <em>iterate</em> over some object, and
compute something for each element. Each one of these computations is one
<em>iteration</em>. Vectorization is the most efficient iteration strategy, but only
works with vectorized functions and vectors. Apply functions are more
flexible—they work with any function and any data structure with
elements—but less efficient and less concise.</p>
<p>A <em>loop</em> is another iteration strategy, one that’s even more flexible than
apply functions. Besides being flexible, loops are a feature of almost all
modern programming languages, so it’s useful to understand them. In R, there
are two kinds of loops. We’ll learn both.</p>
<div id="for-loops" class="section level3" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> For-loops</h3>
<p>A <em>for-loop</em> runs a block of code once for each element of a vector or list.
The <code>for</code> keyword creates a for-loop. Here’s the syntax:</p>
<pre><code>for (I in DATA) {
  # Your code goes here
}</code></pre>
<p>The variable <code>I</code> is called the <em>induction variable</em>. At the beginning of each
iteration, <code>I</code> is assigned the next element of the vector or list <code>DATA</code>. The
loop iterates once for each element of <code>DATA</code>, unless you use a keyword to exit
the loop early (more about this in Section <a href="cleaning-messy-data.html#break-next">4.1.4</a>). As with
if-statements and functions, the curly braces <code>{ }</code> are only required if the
body contains multiple lines of code.</p>
<p>Unlike the other iteration strategies, loops do not automatically return a
result. You have complete control over the output, which means that anything
you want to save must be assigned to a variable.</p>
<p>For example, let’s make a loop that repeatedly adds a number to a running total
and squares the new total. We’ll use a variable <code>total</code> to keep track of the
running total as the loop iterates:</p>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb495-1"><a href="cleaning-messy-data.html#cb495-1" aria-hidden="true" tabindex="-1"></a>numbers <span class="ot">=</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="sc">-</span><span class="dv">3</span>, <span class="dv">2</span>)</span>
<span id="cb495-2"><a href="cleaning-messy-data.html#cb495-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb495-3"><a href="cleaning-messy-data.html#cb495-3" aria-hidden="true" tabindex="-1"></a>total <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb495-4"><a href="cleaning-messy-data.html#cb495-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (number <span class="cf">in</span> numbers) {</span>
<span id="cb495-5"><a href="cleaning-messy-data.html#cb495-5" aria-hidden="true" tabindex="-1"></a>  total <span class="ot">=</span> (total <span class="sc">+</span> number)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb495-6"><a href="cleaning-messy-data.html#cb495-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb495-7"><a href="cleaning-messy-data.html#cb495-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb495-8"><a href="cleaning-messy-data.html#cb495-8" aria-hidden="true" tabindex="-1"></a>total</span></code></pre></div>
<pre><code>## [1] 9</code></pre>
<p>Use for-loops when some or all of the iterations depend on results from other
iterations. If the iterations are not dependent, use one of:</p>
<ol style="list-style-type: decimal">
<li>Vectorization (because it’s faster)</li>
<li>Apply functions (because they’re idiomatic)</li>
</ol>
<p>In some cases, you can use vectorization even when the iterations are
dependent. For example, you can use vectorization to compute the sum of the
cubes of several numbers:</p>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb497-1"><a href="cleaning-messy-data.html#cb497-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(numbers<span class="sc">^</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] -19</code></pre>
</div>
<div id="while-loops" class="section level3" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> While-loops</h3>
<p>A <em>while-loop</em> runs a block of code repeatedly as long as some condition is
<code>TRUE</code>. The <code>while</code> keyword creates a while-loop. Here’s the syntax:</p>
<pre><code>while (CONDITION) {
  # Your code goes here
}</code></pre>
<p>The <code>CONDITION</code> should be a scalar logical value or an expression that returns
one. At the beginning of each iteration, <code>CONDITION</code> is checked, and the loop
exits if it is <code>FALSE</code>. As always, the curly braces <code>{ }</code> are only required if
the body contains multiple lines of code.</p>
<p>For example, suppose you want to add up numbers from 0 to 50, but stop as soon
as the total is greater than 50:</p>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb500-1"><a href="cleaning-messy-data.html#cb500-1" aria-hidden="true" tabindex="-1"></a>num50 <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb500-2"><a href="cleaning-messy-data.html#cb500-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb500-3"><a href="cleaning-messy-data.html#cb500-3" aria-hidden="true" tabindex="-1"></a>total <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb500-4"><a href="cleaning-messy-data.html#cb500-4" aria-hidden="true" tabindex="-1"></a>i <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb500-5"><a href="cleaning-messy-data.html#cb500-5" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (total <span class="sc">&lt;</span> <span class="dv">50</span>) {</span>
<span id="cb500-6"><a href="cleaning-messy-data.html#cb500-6" aria-hidden="true" tabindex="-1"></a>  total <span class="ot">=</span> total <span class="sc">+</span> num50[i]</span>
<span id="cb500-7"><a href="cleaning-messy-data.html#cb500-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">&quot;i is &quot;</span>, i, <span class="st">&quot; total is &quot;</span>, total)</span>
<span id="cb500-8"><a href="cleaning-messy-data.html#cb500-8" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">=</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb500-9"><a href="cleaning-messy-data.html#cb500-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## i is 1 total is 0</code></pre>
<pre><code>## i is 2 total is 1</code></pre>
<pre><code>## i is 3 total is 3</code></pre>
<pre><code>## i is 4 total is 6</code></pre>
<pre><code>## i is 5 total is 10</code></pre>
<pre><code>## i is 6 total is 15</code></pre>
<pre><code>## i is 7 total is 21</code></pre>
<pre><code>## i is 8 total is 28</code></pre>
<pre><code>## i is 9 total is 36</code></pre>
<pre><code>## i is 10 total is 45</code></pre>
<pre><code>## i is 11 total is 55</code></pre>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="cleaning-messy-data.html#cb512-1" aria-hidden="true" tabindex="-1"></a>total</span></code></pre></div>
<pre><code>## [1] 55</code></pre>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="cleaning-messy-data.html#cb514-1" aria-hidden="true" tabindex="-1"></a>i</span></code></pre></div>
<pre><code>## [1] 12</code></pre>
<p>While-loops are a generalization of for-loops. They tend to be most useful when
you don’t know how many iterations will be necessary. For example, suppose you
want to repeat a computation until the result falls within some range of
values.</p>
</div>
<div id="saving-multiple-results" class="section level3" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Saving Multiple Results</h3>
<p>Loops often produce a different result for each iteration. If you want to save
more than one result, there are a few things you must do.</p>
<p>First, set up an index vector. The index vector should usually be congruent to
the number of iterations or the input. The <code>seq_along</code> function returns a
congruent index vector when passed a vector or list. For instance, let’s make
in index for the <code>numbers</code> vector from Section <a href="cleaning-messy-data.html#for-loops">4.1.1</a>:</p>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb516-1"><a href="cleaning-messy-data.html#cb516-1" aria-hidden="true" tabindex="-1"></a>index <span class="ot">=</span> <span class="fu">seq_along</span>(numbers)</span></code></pre></div>
<p>The loop will iterate over the index rather than the input, so the induction
variable will track the current iteration number. On the first iteration, the
induction variable will be 1, on the second it will be 2, and so on. Then you
can use the induction variable and indexing to get the input for each
iteration.</p>
<p>Second, set up an empty output vector or list. This should usually be congruent
to the input, or one element longer (the extra element comes from the initial
value). R has several functions for creating vectors. We’ve already seen a few,
but here are more:</p>
<ul>
<li><p><code>logical</code>, <code>integer</code>, <code>numeric</code>, <code>complex</code>, and <code>character</code> to create an
empty vector with a specific type and length</p></li>
<li><p><code>vector</code> to create an empty vector with a specific type and length</p></li>
<li><p><code>rep</code> to create a vector by repeating elements of some other vector</p></li>
</ul>
<p>Empty vectors are filled with <code>FALSE</code>, <code>0</code>, or <code>""</code>, depending on the type of
the vector. Here are some examples:</p>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb517-1"><a href="cleaning-messy-data.html#cb517-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logical</span>(<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] FALSE FALSE FALSE</code></pre>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb519-1"><a href="cleaning-messy-data.html#cb519-1" aria-hidden="true" tabindex="-1"></a><span class="fu">numeric</span>(<span class="dv">4</span>)</span></code></pre></div>
<pre><code>## [1] 0 0 0 0</code></pre>
<div class="sourceCode" id="cb521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb521-1"><a href="cleaning-messy-data.html#cb521-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 1 2 1 2</code></pre>
<p>Let’s create an empty numeric vector congruent to <code>numbers</code>:</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb523-1"><a href="cleaning-messy-data.html#cb523-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="fu">length</span>(numbers)</span>
<span id="cb523-2"><a href="cleaning-messy-data.html#cb523-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">=</span> <span class="fu">numeric</span>(n)</span></code></pre></div>
<p>As with the input, you can use the induction variable and indexing to set the
output for each iteration.</p>
<p>Creating a vector or list in advance to store something, as we’ve just done, is
called <em>preallocation</em>. Preallocation is extremely important for efficiency in
loops. Avoid the temptation to use <code>c</code> or <code>append</code> to build up the output bit
by bit in each iteration.</p>
<p>Finally, write the loop, making sure to get the input and set the output.
Here’s the loop for the squared sums example:</p>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb524-1"><a href="cleaning-messy-data.html#cb524-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> index) {</span>
<span id="cb524-2"><a href="cleaning-messy-data.html#cb524-2" aria-hidden="true" tabindex="-1"></a>  prev <span class="ot">=</span> <span class="cf">if</span> (i <span class="sc">&gt;</span> <span class="dv">1</span>) result[i <span class="sc">-</span> <span class="dv">1</span>] <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb524-3"><a href="cleaning-messy-data.html#cb524-3" aria-hidden="true" tabindex="-1"></a>  result[i] <span class="ot">=</span> (numbers[i] <span class="sc">+</span> prev)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb524-4"><a href="cleaning-messy-data.html#cb524-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb524-5"><a href="cleaning-messy-data.html#cb524-5" aria-hidden="true" tabindex="-1"></a>result</span></code></pre></div>
<pre><code>## [1] 1 4 1 9</code></pre>
</div>
<div id="break-next" class="section level3" number="4.1.4">
<h3><span class="header-section-number">4.1.4</span> Break &amp; Next</h3>
<p>The <code>break</code> keyword causes a loop to immediately exit. It only makes sense to
use <code>break</code> inside of an if-statement.</p>
<p>For example, suppose we want to print each string in a vector, but stop at the
first missing value. We can do this with <code>break</code>:</p>
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb526-1"><a href="cleaning-messy-data.html#cb526-1" aria-hidden="true" tabindex="-1"></a>my_messages <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Hi&quot;</span>, <span class="st">&quot;Hello&quot;</span>, <span class="cn">NA</span>, <span class="st">&quot;Goodbye&quot;</span>)</span>
<span id="cb526-2"><a href="cleaning-messy-data.html#cb526-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb526-3"><a href="cleaning-messy-data.html#cb526-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (msg <span class="cf">in</span> my_messages) {</span>
<span id="cb526-4"><a href="cleaning-messy-data.html#cb526-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(msg))</span>
<span id="cb526-5"><a href="cleaning-messy-data.html#cb526-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span>
<span id="cb526-6"><a href="cleaning-messy-data.html#cb526-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb526-7"><a href="cleaning-messy-data.html#cb526-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(msg)</span>
<span id="cb526-8"><a href="cleaning-messy-data.html#cb526-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Hi</code></pre>
<pre><code>## Hello</code></pre>
<p>The <code>next</code> keyword causes a loop to immediately go to the next iteration. As
with <code>break</code>, it only makes sense to use <code>next</code> inside of an if-statement.</p>
<p>Let’s modify the previous example so that missing values are skipped, but don’t
cause printing to stop. Here’s the code:</p>
<div class="sourceCode" id="cb529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb529-1"><a href="cleaning-messy-data.html#cb529-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (msg <span class="cf">in</span> my_messages) {</span>
<span id="cb529-2"><a href="cleaning-messy-data.html#cb529-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(msg))</span>
<span id="cb529-3"><a href="cleaning-messy-data.html#cb529-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">next</span></span>
<span id="cb529-4"><a href="cleaning-messy-data.html#cb529-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb529-5"><a href="cleaning-messy-data.html#cb529-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(msg)</span>
<span id="cb529-6"><a href="cleaning-messy-data.html#cb529-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Hi</code></pre>
<pre><code>## Hello</code></pre>
<pre><code>## Goodbye</code></pre>
<p>These keywords work with both for-loops and while-loops.</p>
</div>
<div id="example-fibonacci" class="section level3" number="4.1.5">
<h3><span class="header-section-number">4.1.5</span> Example: Fibonacci</h3>
<p>As a final example, let’s use a loop to compute Fibonacci numbers. Each
Fibonacci number is the sum of the previous two. The first few Fibonacci
numbers are:</p>
<pre><code>1 1 2 3 5 8 13</code></pre>
<p>We can use a loop to compute the first <code>n</code> Fibonacci numbers. Make sure to
choose an appropriate index and to preallocate for the output:</p>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb534-1"><a href="cleaning-messy-data.html#cb534-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb534-2"><a href="cleaning-messy-data.html#cb534-2" aria-hidden="true" tabindex="-1"></a>fib <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fu">numeric</span>(n <span class="sc">-</span> <span class="dv">2</span>))</span>
<span id="cb534-3"><a href="cleaning-messy-data.html#cb534-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb534-4"><a href="cleaning-messy-data.html#cb534-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">3</span><span class="sc">:</span>n) {</span>
<span id="cb534-5"><a href="cleaning-messy-data.html#cb534-5" aria-hidden="true" tabindex="-1"></a>  fib[i] <span class="ot">=</span> fib[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> fib[i <span class="sc">-</span> <span class="dv">2</span>]</span>
<span id="cb534-6"><a href="cleaning-messy-data.html#cb534-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb534-7"><a href="cleaning-messy-data.html#cb534-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb534-8"><a href="cleaning-messy-data.html#cb534-8" aria-hidden="true" tabindex="-1"></a>fib</span></code></pre></div>
<pre><code>##  [1]  1  1  2  3  5  8 13 21 34 55</code></pre>
<p>If you want to reuse this code, you could make it a function:</p>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb536-1"><a href="cleaning-messy-data.html#cb536-1" aria-hidden="true" tabindex="-1"></a>fibonacci <span class="ot">=</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">10</span>) {</span>
<span id="cb536-2"><a href="cleaning-messy-data.html#cb536-2" aria-hidden="true" tabindex="-1"></a>  fib <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="fu">numeric</span>(n <span class="sc">-</span> <span class="dv">2</span>))</span>
<span id="cb536-3"><a href="cleaning-messy-data.html#cb536-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb536-4"><a href="cleaning-messy-data.html#cb536-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">3</span><span class="sc">:</span>n) {</span>
<span id="cb536-5"><a href="cleaning-messy-data.html#cb536-5" aria-hidden="true" tabindex="-1"></a>    fib[i] <span class="ot">=</span> fib[i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span> fib[i <span class="sc">-</span> <span class="dv">2</span>]</span>
<span id="cb536-6"><a href="cleaning-messy-data.html#cb536-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb536-7"><a href="cleaning-messy-data.html#cb536-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb536-8"><a href="cleaning-messy-data.html#cb536-8" aria-hidden="true" tabindex="-1"></a>  fib</span>
<span id="cb536-9"><a href="cleaning-messy-data.html#cb536-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb536-10"><a href="cleaning-messy-data.html#cb536-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb536-11"><a href="cleaning-messy-data.html#cb536-11" aria-hidden="true" tabindex="-1"></a><span class="fu">fibonacci</span>(<span class="dv">30</span>)</span></code></pre></div>
<pre><code>##  [1]      1      1      2      3      5      8     13     21     34     55
## [11]     89    144    233    377    610    987   1597   2584   4181   6765
## [21]  10946  17711  28657  46368  75025 121393 196418 317811 514229 832040</code></pre>
</div>
</div>
<div id="planning-for-iteration" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Planning for Iteration</h2>
<p>At first it may seem difficult to decide if and what kind of iteration to use.
Start by thinking about whether you need to do something over and over. If you
don’t, then you probably don’t need to use iteration. If you do, then try
iteration strategies in this order:</p>
<ol style="list-style-type: decimal">
<li>vectorization</li>
<li>apply functions
<ul>
<li>Try an apply function if iterations are independent.</li>
</ul></li>
<li>for/while-loops
<ul>
<li>Try a for-loop if some iterations depend on others.</li>
<li>Try a while-loop if the number of iterations is unknown.</li>
</ul></li>
<li>recursion (which isn’t covered here)
<ul>
<li>Convenient for naturally recursive problems (like Fibonacci),
but often there are faster solutions.</li>
</ul></li>
</ol>
<p>Start by writing the code for just one iteration. Make sure that code works;
it’s easy to test code for one iteration.</p>
<p>When you have one iteration working, then try using the code with an iteration
strategy (you will have to make some small changes). If it doesn’t work, try to
figure out which iteration is causing the problem. One way to do this is to use
<code>message</code> to print out information. Then try to write the code for the broken
iteration, get that iteration working, and repeat this whole process.</p>
</div>
<div id="string-processing" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> String Processing</h2>
<p>So far, we’ve mostly worked with numbers or categories that are ready to use
for data analysis. In practice, data sets often require some cleaning before or
during data analysis. One common data cleaning task is editing or extracting
parts of strings.</p>
<p>We’ll use the stringr package to process strings. Like ggplot2 (Section
<a href="exploring-your-data.html#data-visualization">3.6</a>), the package is part of the <a href="https://www.tidyverse.org/">Tidyverse</a>. R
also has built-in functions for string processing. The main advantage of
stringr is that its functions use a common set of parameters, so they’re easier
to learn and remember.</p>
<p>stringr has detailed <a href="https://stringr.tidyverse.org/">documentation</a> and also a
<a href="https://github.com/rstudio/cheatsheets/blob/master/strings.pdf">cheatsheet</a>.</p>
<p>The first time you use stringr, you’ll have to install it with
<code>install.packages</code> (the same as any other package). Then you can load the
package with the <code>library</code> function:</p>
<div class="sourceCode" id="cb538"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb538-1"><a href="cleaning-messy-data.html#cb538-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;stringr&quot;)</span></span>
<span id="cb538-2"><a href="cleaning-messy-data.html#cb538-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span></code></pre></div>
<p>The typical syntax of a stringr function is:</p>
<pre><code>str_NAME(string, pattern, ...)</code></pre>
<p>Where:</p>
<ul>
<li><code>NAME</code> describes what the function does</li>
<li><code>string</code> is the string to search within or transform</li>
<li><code>pattern</code> is the pattern to search for</li>
<li><code>...</code> is additional, function-specific arguments</li>
</ul>
<p>The <code>str_detect</code> function detects whether the pattern appears within the
string. Here’s an example:</p>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="cleaning-messy-data.html#cb540-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(<span class="st">&quot;hello&quot;</span>, <span class="st">&quot;el&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb542-1"><a href="cleaning-messy-data.html#cb542-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(<span class="st">&quot;hello&quot;</span>, <span class="st">&quot;ol&quot;</span>)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>Most of the stringr functions are vectorized in the <code>string</code> parameter. For
instance:</p>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb544-1"><a href="cleaning-messy-data.html#cb544-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(<span class="fu">c</span>(<span class="st">&quot;hello&quot;</span>, <span class="st">&quot;goodbye&quot;</span>, <span class="st">&quot;lo&quot;</span>), <span class="st">&quot;lo&quot;</span>)</span></code></pre></div>
<pre><code>## [1]  TRUE FALSE  TRUE</code></pre>
<p>Most of the stringr functions also have support for <a href="https://en.wikipedia.org/wiki/Regular_expression"><em>regular
expressions</em></a>, a powerful language for describing patterns. Several
punctuation characters, such as <code>.</code> and <code>?</code> have special meanings in the
regular expressions language. You can disable these special meanings by putting
the pattern in a call to <code>fixed</code>:</p>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb546-1"><a href="cleaning-messy-data.html#cb546-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;.&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb548-1"><a href="cleaning-messy-data.html#cb548-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(<span class="st">&quot;a&quot;</span>, <span class="fu">fixed</span>(<span class="st">&quot;.&quot;</span>))</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>You can learn more about regular expressions <a href="https://r4ds.had.co.nz/strings.html#matching-patterns-with-regular-expressions">here</a>.</p>
<p>There are a lot of stringr functions. We’ll focus on two that are especially
important, and some of their variants:</p>
<ul>
<li><code>str_split</code></li>
<li><code>str_replace</code></li>
</ul>
<p>You can find a complete list of stringr functions, with examples, in the
documentation.</p>
<div id="splitting-strings" class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Splitting Strings</h3>
<p>The <code>str_split</code> function splits the string at each position that matches the
pattern. The characters that match are thrown away.</p>
<p>For example, suppose we want to split a sentence into words. Since there’s a
space between each word, we can use a space as the pattern:</p>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb550-1"><a href="cleaning-messy-data.html#cb550-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="st">&quot;The students in this workshop are great!&quot;</span></span>
<span id="cb550-2"><a href="cleaning-messy-data.html#cb550-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb550-3"><a href="cleaning-messy-data.html#cb550-3" aria-hidden="true" tabindex="-1"></a>result <span class="ot">=</span> <span class="fu">str_split</span>(x, <span class="st">&quot; &quot;</span>)</span>
<span id="cb550-4"><a href="cleaning-messy-data.html#cb550-4" aria-hidden="true" tabindex="-1"></a>result</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;The&quot;      &quot;students&quot; &quot;in&quot;       &quot;this&quot;     &quot;workshop&quot; &quot;are&quot;      &quot;great!&quot;</code></pre>
<p>The <code>str_split</code> function always returns a list with one element for each input
string. Here the list only has one element because <code>x</code> only has one element. We
can get the first element with:</p>
<div class="sourceCode" id="cb552"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb552-1"><a href="cleaning-messy-data.html#cb552-1" aria-hidden="true" tabindex="-1"></a>result[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## [1] &quot;The&quot;      &quot;students&quot; &quot;in&quot;       &quot;this&quot;     &quot;workshop&quot; &quot;are&quot;      &quot;great!&quot;</code></pre>
<p>We have to use the extraction operator <code>[[</code> here because <code>x</code> is a list (for a
vector, we could use the indexing operator <code>[</code> instead). Notice that in the
printout for <code>result</code>, R gives us a hint that we should use <code>[[</code> by printing
<code>[[1]]</code>.</p>
<p>To see why the function returns a list, consider what happens if we try to
split two different sentences at once:</p>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb554-1"><a href="cleaning-messy-data.html#cb554-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(x, <span class="st">&quot;Are you listening?&quot;</span>)</span>
<span id="cb554-2"><a href="cleaning-messy-data.html#cb554-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb554-3"><a href="cleaning-messy-data.html#cb554-3" aria-hidden="true" tabindex="-1"></a>result <span class="ot">=</span> <span class="fu">str_split</span>(x, <span class="st">&quot; &quot;</span>)</span>
<span id="cb554-4"><a href="cleaning-messy-data.html#cb554-4" aria-hidden="true" tabindex="-1"></a>result[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## [1] &quot;The&quot;      &quot;students&quot; &quot;in&quot;       &quot;this&quot;     &quot;workshop&quot; &quot;are&quot;      &quot;great!&quot;</code></pre>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb556-1"><a href="cleaning-messy-data.html#cb556-1" aria-hidden="true" tabindex="-1"></a>result[[<span class="dv">2</span>]]</span></code></pre></div>
<pre><code>## [1] &quot;Are&quot;        &quot;you&quot;        &quot;listening?&quot;</code></pre>
<p>Each sentence has a different number of words, so the vectors in the result
have different lengths. So a list is the only way to store both.</p>
<p>The <code>str_split_fixed</code> function is almost the same as <code>str_split</code>, but takes a
third argument for the maximum number of splits to make. Because the number of
splits is fixed, the function can return the result in a matrix instead of a
list. For example:</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb558-1"><a href="cleaning-messy-data.html#cb558-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_split_fixed</span>(x, <span class="st">&quot; &quot;</span>, <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##      [,1]  [,2]       [,3]                         
## [1,] &quot;The&quot; &quot;students&quot; &quot;in this workshop are great!&quot;
## [2,] &quot;Are&quot; &quot;you&quot;      &quot;listening?&quot;</code></pre>
<p>The <code>str_split_fixed</code> function is often more convenient than <code>str_split</code>
because the <code>n</code>th piece of each input string is just the <code>n</code>th column of the
result.</p>
<p>For example, suppose we want to get the area code from some phone numbers:</p>
<div class="sourceCode" id="cb560"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb560-1"><a href="cleaning-messy-data.html#cb560-1" aria-hidden="true" tabindex="-1"></a>phones <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;717-555-3421&quot;</span>, <span class="st">&quot;629-555-8902&quot;</span>, <span class="st">&quot;903-555-6781&quot;</span>)</span>
<span id="cb560-2"><a href="cleaning-messy-data.html#cb560-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">=</span> <span class="fu">str_split_fixed</span>(phones, <span class="st">&quot;-&quot;</span>, <span class="dv">3</span>)</span>
<span id="cb560-3"><a href="cleaning-messy-data.html#cb560-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb560-4"><a href="cleaning-messy-data.html#cb560-4" aria-hidden="true" tabindex="-1"></a>result[, <span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] &quot;717&quot; &quot;629&quot; &quot;903&quot;</code></pre>
</div>
<div id="replacing-parts-of-strings" class="section level3" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Replacing Parts of Strings</h3>
<p>The <code>str_replace</code> function replaces the pattern the first time it appears in
the string. The replacement goes in the third argument.</p>
<p>For instance, suppose we want to change the word <code>"dog"</code> to <code>"cat"</code>:</p>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb562-1"><a href="cleaning-messy-data.html#cb562-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;dogs are great, dogs are fun&quot;</span>, <span class="st">&quot;dogs are fluffy&quot;</span>)</span>
<span id="cb562-2"><a href="cleaning-messy-data.html#cb562-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace</span>(x, <span class="st">&quot;dog&quot;</span>, <span class="st">&quot;cat&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;cats are great, dogs are fun&quot; &quot;cats are fluffy&quot;</code></pre>
<p>The <code>str_replace_all</code> function replaces the pattern every time it appears in
the string:</p>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb564-1"><a href="cleaning-messy-data.html#cb564-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace_all</span>(x, <span class="st">&quot;dog&quot;</span>, <span class="st">&quot;cat&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;cats are great, cats are fun&quot; &quot;cats are fluffy&quot;</code></pre>
<p>We can also use the <code>str_replace</code> and <code>str_replace_all</code> functions to delete
part of a string by setting the replacement to the empty string <code>""</code>.</p>
<p>For example, suppose we want to delete the comma:</p>
<div class="sourceCode" id="cb566"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb566-1"><a href="cleaning-messy-data.html#cb566-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace</span>(x, <span class="st">&quot;,&quot;</span>, <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;dogs are great dogs are fun&quot; &quot;dogs are fluffy&quot;</code></pre>
<p>In general, stringr functions with the <code>_all</code> suffix affect all matches.
Functions without <code>_all</code> only affect the first match.</p>
</div>
</div>
<div id="date-processing" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Date Processing</h2>
<p>Besides strings, dates and times are another kind of data that require special
attention to prepare for analysis. This is especially important if you want to
do anything that involves sorting dates, like making a line plot with dates on
one axis. Dates may not be sorted correctly if they haven’t been converted to
one of R’s date classes.</p>
<p>There several built-in functions and also many packages for date processing. As
with visualization and string processing, the Tidyverse packages have the best
combination of simple design and clear documentation. There are three Tidyverse
packages for processing dates and times:</p>
<ul>
<li><a href="https://lubridate.tidyverse.org/">lubridate</a>, the primary package for working with dates and times</li>
<li><a href="https://hms.tidyverse.org/">hms</a>, a package specifically for working with times</li>
<li><a href="https://clock.r-lib.org/">clock</a>, a new package for working with dates and times</li>
</ul>
<p>We’ll focus on the lubridate package. As always, you’ll have to install the
package if you haven’t already, and then load it:</p>
<div class="sourceCode" id="cb568"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb568-1"><a href="cleaning-messy-data.html#cb568-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&quot;lubridate&quot;)</span></span>
<span id="cb568-2"><a href="cleaning-messy-data.html#cb568-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;lubridate&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     date, intersect, setdiff, union</code></pre>
<p>The most common task is to convert a string into a date or time class. For
instance, when you load a data set, you might have dates that look like this:</p>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb571-1"><a href="cleaning-messy-data.html#cb571-1" aria-hidden="true" tabindex="-1"></a>dates <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Jan 10, 2021&quot;</span>, <span class="st">&quot;Sep 3, 2018&quot;</span>, <span class="st">&quot;Feb 28, 1982&quot;</span>)</span>
<span id="cb571-2"><a href="cleaning-messy-data.html#cb571-2" aria-hidden="true" tabindex="-1"></a>dates</span></code></pre></div>
<pre><code>## [1] &quot;Jan 10, 2021&quot; &quot;Sep 3, 2018&quot;  &quot;Feb 28, 1982&quot;</code></pre>
<p>These are strings, so it’s relatively difficult to sort the dates, do
arithmetic on them, or extract just one part (such as the year). There are
several lubridate functions to automatically convert strings into dates. They
are named with one letter for each part of the date. For instance, the dates in
the example have the month (m), then the day (d), and then the year (y), so we
can use the <code>mdy</code> function:</p>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb573-1"><a href="cleaning-messy-data.html#cb573-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">=</span> <span class="fu">mdy</span>(dates)</span>
<span id="cb573-2"><a href="cleaning-messy-data.html#cb573-2" aria-hidden="true" tabindex="-1"></a>result</span></code></pre></div>
<pre><code>## [1] &quot;2021-01-10&quot; &quot;2018-09-03&quot; &quot;1982-02-28&quot;</code></pre>
<div class="sourceCode" id="cb575"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb575-1"><a href="cleaning-messy-data.html#cb575-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(result)</span></code></pre></div>
<pre><code>## [1] &quot;Date&quot;</code></pre>
<p>Notice that the dates now have class <code>Date</code>, one of R’s built-in classes for
representing dates, and that they print differently. You can find a full list
of the automatic string to date conversion functions in the lubridate
documentation.</p>
<p>Occasionally, a date string may have a format that lubridate can’t convert
automatically. In that case, you can use the <code>fast_strptime</code> function to
describe the format in detail. At a minimum, the function requires two
arguments: the vector of strings to convert and a format string.</p>
<p>The format string describes the format of the dates, and is based on the syntax
of <code>strptime</code>, a function provided by many programming languages for converting
strings to dates (including R). In a format string, a percent sign <code>%</code> followed
by a character is called a <em>specification</em> and has a special meaning. Here are
a few of the most useful ones:</p>
<table>
<thead>
<tr class="header">
<th align="left">Specification</th>
<th align="left">Description</th>
<th align="left">January 29, 2015</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>%Y</code></td>
<td align="left">4-digit year</td>
<td align="left">2015</td>
</tr>
<tr class="even">
<td align="left"><code>%y</code></td>
<td align="left">2-digit year</td>
<td align="left">15</td>
</tr>
<tr class="odd">
<td align="left"><code>%m</code></td>
<td align="left">2-digit month</td>
<td align="left">01</td>
</tr>
<tr class="even">
<td align="left"><code>%B</code></td>
<td align="left">full month name</td>
<td align="left">January</td>
</tr>
<tr class="odd">
<td align="left"><code>%b</code></td>
<td align="left">short month name</td>
<td align="left">Jan</td>
</tr>
<tr class="even">
<td align="left"><code>%d</code></td>
<td align="left">day of month</td>
<td align="left">29</td>
</tr>
<tr class="odd">
<td align="left"><code>%%</code></td>
<td align="left">literal %</td>
<td align="left">%</td>
</tr>
</tbody>
</table>
<p>You can find a complete list in <code>?fast_strptime</code>. Other characters in the
format string do not have any special meaning. Write the format string so that
it matches the format of the dates you want to convert.</p>
<p>For example, let’s try converting an unusual time format:</p>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb577-1"><a href="cleaning-messy-data.html#cb577-1" aria-hidden="true" tabindex="-1"></a>odd_time <span class="ot">=</span> <span class="st">&quot;6 minutes, 32 seconds after 10 o&#39;clock&quot;</span></span>
<span id="cb577-2"><a href="cleaning-messy-data.html#cb577-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fast_strptime</span>(odd_time, <span class="st">&quot;%M minutes, %S seconds after %H o&#39;clock&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;0-01-01 10:06:32 UTC&quot;</code></pre>
<p>R usually represents dates with the class <code>Date</code>, and date-times with the
classes <code>POSIXct</code> and <code>POSIXlt</code>. The difference between the two date-time
classes is somewhat technical, but you can read more about it in <code>?POSIXlt</code>.</p>
<p>There is no built-in class to represent times alone, which is why the result in
the example above includes a date. Nonetheless, the hms package provides the
<code>hms</code> class to represent times without dates.</p>
<p>Once you’ve converted a string to a date, the lubridate package provides a
variety of functions to get or set the parts individually. Here are a few
examples:</p>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb579-1"><a href="cleaning-messy-data.html#cb579-1" aria-hidden="true" tabindex="-1"></a><span class="fu">day</span>(result)</span></code></pre></div>
<pre><code>## [1] 10  3 28</code></pre>
<div class="sourceCode" id="cb581"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb581-1"><a href="cleaning-messy-data.html#cb581-1" aria-hidden="true" tabindex="-1"></a><span class="fu">month</span>(result)</span></code></pre></div>
<pre><code>## [1] 1 9 2</code></pre>
<p>You can find a complete list in the lubridate documentation.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="exploring-your-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="where-to-learn-more.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ucdavisdatalab/workshop_r_basics/edit/master/04_cleaning-messy-data.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/ucdavisdatalab/workshop_r_basics/blob/master/04_cleaning-messy-data.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
